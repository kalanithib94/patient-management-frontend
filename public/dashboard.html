<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eye-Docs KTP Demo - Dashboard</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .dashboard-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #007bff;
        }
        .dashboard-card h3 {
            margin-top: 0;
            color: #333;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-healthy { background-color: #28a745; }
        .status-degraded { background-color: #ffc107; }
        .status-unhealthy { background-color: #dc3545; }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
            margin: 10px 0;
        }
        .metric-label {
            color: #666;
            font-size: 0.9em;
        }
        .api-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .api-endpoint {
            font-family: monospace;
            background: #e9ecef;
            padding: 5px 8px;
            border-radius: 3px;
            margin: 5px 0;
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .feature-list li:before {
            content: "‚úÖ ";
            margin-right: 10px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background-color: #007bff;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="text-center">
            <h1>üîÆ Eye-Docs KTP Demo Dashboard</h1>
            <p class="lead">Complete Healthcare Referral Management System</p>
        </header>

        <div class="dashboard-grid">
            <!-- System Status -->
            <div class="dashboard-card">
                <h3>üöÄ System Status</h3>
                <div id="system-status">
                    <p>Loading system status...</p>
                </div>
            </div>

            <!-- Database Status -->
            <div class="dashboard-card">
                <h3>üóÑÔ∏è Database Status</h3>
                <div id="database-status">
                    <p>Loading database status...</p>
                </div>
            </div>

            <!-- API Endpoints -->
            <div class="dashboard-card">
                <h3>üîå API Endpoints</h3>
                <div class="api-section">
                    <h4>Working Endpoints:</h4>
                    <div class="api-endpoint">GET /api/status</div>
                    <div class="api-endpoint">GET /api/health</div>
                    <div class="api-endpoint">GET /api/config</div>
                    <div class="api-endpoint">GET /api/opticians</div>
                    <div class="api-endpoint">GET /api/referrals</div>
                    <div class="api-endpoint">GET /api/analytics/dashboard</div>
                    <div class="api-endpoint">GET /api/salesforce/test</div>
                </div>
            </div>

            <!-- Features Overview -->
            <div class="dashboard-card">
                <h3>‚ú® Features Overview</h3>
                <ul class="feature-list">
                    <li>PHP 8.4 Backend with SQLite Database</li>
                    <li>RESTful API with CORS Support</li>
                    <li>Referral Management System</li>
                    <li>Analytics Dashboard</li>
                    <li>Python Forecasting Engine</li>
                    <li>Salesforce Integration Framework</li>
                    <li>Real-time Health Monitoring</li>
                    <li>Comprehensive Logging</li>
                </ul>
            </div>

            <!-- Analytics Summary -->
            <div class="dashboard-card">
                <h3>üìä Analytics Summary</h3>
                <div id="analytics-summary">
                    <p>Loading analytics...</p>
                </div>
            </div>

            <!-- Salesforce Integration -->
            <div class="dashboard-card">
                <h3>‚òÅÔ∏è Salesforce Integration</h3>
                <div id="salesforce-status">
                    <p>Loading Salesforce status...</p>
                </div>
            </div>
        </div>

        <!-- System Progress -->
        <div class="dashboard-card">
            <h3>üìà System Implementation Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 85%"></div>
            </div>
            <p><strong>85% Complete</strong> - Core system operational, advanced features implemented</p>
            
            <div style="margin-top: 20px;">
                <h4>‚úÖ Completed:</h4>
                <ul>
                    <li>Backend API Server (PHP 8.4)</li>
                    <li>SQLite Database with Schema</li>
                    <li>Core API Endpoints</li>
                    <li>Analytics Dashboard</li>
                    <li>Python Forecasting Engine</li>
                    <li>Salesforce Integration Framework</li>
                    <li>Health Monitoring</li>
                    <li>Error Handling & Logging</li>
                </ul>
                
                <h4>üöß In Progress:</h4>
                <ul>
                    <li>Frontend User Interface</li>
                    <li>Advanced Analytics</li>
                    <li>User Authentication</li>
                </ul>
                
                <h4>üìã Next Steps:</h4>
                <ul>
                    <li>MySQL Database Migration</li>
                    <li>Salesforce Credentials Setup</li>
                    <li>Production Deployment</li>
                    <li>Performance Optimization</li>
                </ul>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="dashboard-card">
            <h3>‚ö° Quick Actions</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <button onclick="testAPI('status')" class="btn btn-primary">Test Status API</button>
                <button onclick="testAPI('health')" class="btn btn-success">Test Health API</button>
                <button onclick="testAPI('analytics')" class="btn btn-info">Test Analytics</button>
                <button onclick="testAPI('salesforce')" class="btn btn-warning">Test Salesforce</button>
            </div>
        </div>
    </div>

    <script>
        // Load dashboard data
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemStatus();
            loadDatabaseStatus();
            loadAnalyticsSummary();
            loadSalesforceStatus();
        });

        async function loadSystemStatus() {
            try {
                const response = await fetch('http://localhost:3001');
                const data = await response.json();
                
                document.getElementById('system-status').innerHTML = `
                    <div class="status-indicator status-healthy"></div>
                    <strong>Status:</strong> ${data.status}<br>
                    <strong>Message:</strong> ${data.message}<br>
                    <strong>Endpoints:</strong> ${Object.keys(data.endpoints).length} available<br>
                    <strong>Timestamp:</strong> ${new Date().toLocaleString()}
                `;
            } catch (error) {
                document.getElementById('system-status').innerHTML = `
                    <div class="status-indicator status-unhealthy"></div>
                    <strong>Error:</strong> ${error.message}
                `;
            }
        }

        async function loadDatabaseStatus() {
            try {
                const response = await fetch('http://localhost:8001/api/status');
                const data = await response.json();
                
                document.getElementById('database-status').innerHTML = `
                    <div class="status-indicator status-healthy"></div>
                    <strong>Status:</strong> ${data.status}<br>
                    <strong>Service:</strong> ${data.data.service}<br>
                    <strong>Version:</strong> ${data.data.version}<br>
                    <strong>Timestamp:</strong> ${new Date(data.timestamp).toLocaleString()}
                `;
            } catch (error) {
                document.getElementById('database-status').innerHTML = `
                    <div class="status-indicator status-unhealthy"></div>
                    <strong>Error:</strong> ${error.message}
                `;
            }
        }

        async function loadAnalyticsSummary() {
            try {
                const response = await fetch('http://localhost:8001/api/status');
                const data = await response.json();
                
                document.getElementById('analytics-summary').innerHTML = `
                    <div class="metric-value">Analytics Ready</div>
                    <div class="metric-label">Python Engine</div>
                    <strong>Service:</strong> ${data.data.service}<br>
                    <strong>Status:</strong> ${data.status}<br>
                    <strong>Version:</strong> ${data.data.version}<br>
                    <strong>ARIMA Forecasting:</strong> Available
                `;
            } catch (error) {
                document.getElementById('analytics-summary').innerHTML = `
                    <div class="status-indicator status-unhealthy"></div>
                    <strong>Error:</strong> ${error.message}
                `;
            }
        }

        async function loadSalesforceStatus() {
            try {
                const response = await fetch('http://localhost:3001/api/salesforce/status');
                const data = await response.json();
                
                const statusClass = data.connected ? 'status-healthy' : 'status-degraded';
                
                document.getElementById('salesforce-status').innerHTML = `
                    <div class="status-indicator ${statusClass}"></div>
                    <strong>Status:</strong> ${data.connected ? 'Connected' : 'Configured'}<br>
                    <strong>Message:</strong> ${data.message}<br>
                    <strong>Instance URL:</strong> ${data.instanceUrl || 'Demo Mode'}<br>
                    <strong>Access Token:</strong> ${data.accessToken || 'Demo Mode'}
                `;
            } catch (error) {
                document.getElementById('salesforce-status').innerHTML = `
                    <div class="status-indicator status-unhealthy"></div>
                    <strong>Error:</strong> ${error.message}
                `;
            }
        }

        async function testAPI(endpoint) {
            try {
                const response = await fetch(`http://localhost:3001/api/salesforce/${endpoint}`);
                const data = await response.json();
                
                alert(`${endpoint.toUpperCase()} API Test:\nStatus: ${data.status}\nMessage: ${data.message || 'Success'}`);
            } catch (error) {
                alert(`API Test Failed: ${error.message}`);
            }
        }
    </script>
</body>
</html>

